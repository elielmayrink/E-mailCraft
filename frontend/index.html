<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>📧 Sistema de Classificação de Emails</title>
  <link rel="stylesheet" href="styles.css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
  <div class="container">
    <!-- Header -->
    <header class="header">
      <div class="header-content">
        <div class="logo">
          <i class="fas fa-envelope-open-text"></i>
          <h1>Sistema de Classificação de Emails</h1>
        </div>
        <p class="subtitle">Classifique automaticamente seus emails e gere respostas inteligentes</p>

        <!-- Seção de Login -->
        <div id="loginSection" class="auth-section" style="display: none;">
          <div class="login-card">
            <h3><i class="fas fa-sign-in-alt"></i> Faça Login para Continuar</h3>
            <p>Entre com sua conta Google para acessar o sistema</p>
            <button id="loginBtn" class="btn btn-google" onclick="window.authComponents.handleLogin()">
              <i class="fab fa-google"></i>
              Entrar com Google
            </button>
          </div>
        </div>

        <!-- Seção do Usuário -->
        <div id="userSection" class="auth-section" style="display: none;">
          <div class="user-card">
            <div class="user-info">
              <img id="userPhoto" src="" alt="Usuário" class="user-photo">
              <div class="user-details">
                <h4 id="userName">Usuário</h4>
                <p id="userEmail">email@exemplo.com</p>
              </div>
            </div>
            <button id="logoutBtn" class="btn btn-secondary" onclick="window.authComponents.handleLogout()">
              <i class="fas fa-sign-out-alt"></i>
              Sair
            </button>
          </div>
        </div>

        <!-- Seção do Gmail -->
        <div id="gmailSection" class="auth-section" style="display: none;">
          <div class="gmail-card">
            <div class="gmail-status">
              <i class="fab fa-google"></i>
              <span id="gmailStatus">Verificando conexão...</span>
            </div>
            <div class="gmail-actions">
              <button id="connectGmailBtn" class="btn btn-primary" onclick="window.authComponents.handleConnectGmail()">
                <i class="fas fa-link"></i>
                Conectar Gmail
              </button>
              <button id="disconnectGmailBtn" class="btn btn-danger"
                onclick="window.authComponents.handleDisconnectGmail()" style="display: none;">
                <i class="fas fa-unlink"></i>
                Desconectar Gmail
              </button>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Upload Section -->
      <section class="upload-section">
        <div class="upload-card">
          <div class="upload-header">
            <h2><i class="fas fa-upload"></i> Upload de Email</h2>
            <p>Faça upload de um arquivo de email ou cole o texto diretamente</p>
          </div>

          <!-- Text Input -->
          <div class="input-group">
            <label for="emailText">
              <i class="fas fa-edit"></i>
              Texto do Email
            </label>
            <textarea id="emailText" placeholder="Cole aqui o conteúdo do email que deseja classificar..."
              rows="8"></textarea>
          </div>

          <!-- File Upload -->
          <div class="input-group">
            <label for="emailFile">
              <i class="fas fa-file-upload"></i>
              Ou faça upload de um arquivo
            </label>
            <div class="file-upload-area" id="fileUploadArea">
              <div class="file-upload-content">
                <i class="fas fa-cloud-upload-alt"></i>
                <p>Arraste e solte seu arquivo aqui</p>
                <p class="file-types">Suporta: .txt, .pdf</p>
                <button type="button" class="btn btn-secondary" id="selectFileBtn">
                  <i class="fas fa-folder-open"></i>
                  Escolher Arquivo
                </button>
              </div>
              <input type="file" id="emailFile" accept=".txt,.pdf" style="display: none;">
            </div>
            <div class="file-info" id="fileInfo" style="display: none;">
              <div class="file-details">
                <i class="fas fa-file"></i>
                <span class="file-name"></span>
                <span class="file-size"></span>
              </div>
              <button type="button" class="btn-remove" onclick="removeFile()">
                <i class="fas fa-times"></i>
              </button>
            </div>
          </div>

          <!-- Submit Button -->
          <div class="submit-section">
            <button type="button" class="btn btn-primary" id="classifyBtn">
              <i class="fas fa-magic"></i>
              Classificar Email
            </button>
          </div>
        </div>
      </section>

      <!-- Results Section -->
      <section class="results-section" id="resultsSection" style="display: none;">
        <div class="results-card">
          <div class="results-header">
            <h2><i class="fas fa-chart-line"></i> Resultados da Classificação</h2>
          </div>

          <div class="results-content">
            <!-- Category -->
            <div class="result-item">
              <div class="result-label">
                <i class="fas fa-tag"></i>
                Categoria
              </div>
              <div class="result-value" id="categoryResult">
                <span class="category-badge" id="categoryBadge"></span>
              </div>
            </div>

            <!-- Confidence -->
            <div class="result-item">
              <div class="result-label">
                <i class="fas fa-percentage"></i>
                Confiança
              </div>
              <div class="result-value">
                <div class="confidence-bar">
                  <div class="confidence-fill" id="confidenceFill"></div>
                </div>
                <span class="confidence-text" id="confidenceText"></span>
              </div>
            </div>

            <!-- AI Response -->
            <div class="result-item">
              <div class="result-label">
                <i class="fas fa-robot"></i>
                Resposta Sugerida
              </div>
              <div class="result-value">
                <div class="response-box" id="responseBox">
                  <p id="responseText"></p>
                </div>
                <button type="button" class="btn btn-secondary btn-sm" onclick="copyResponse()">
                  <i class="fas fa-copy"></i>
                  Copiar Resposta
                </button>
              </div>
            </div>

            <!-- File Info (if uploaded) -->
            <div class="result-item" id="fileResultItem" style="display: none;">
              <div class="result-label">
                <i class="fas fa-file"></i>
                Arquivo Processado
              </div>
              <div class="result-value">
                <span id="processedFileName"></span>
              </div>
            </div>

            <!-- Method Info -->
            <div class="result-item">
              <div class="result-label">
                <i class="fas fa-cogs"></i>
                Método de Análise
              </div>
              <div class="result-value">
                <div class="method-info">
                  <span class="method-badge" id="methodBadge"></span>
                  <span class="method-description" id="methodDescription"></span>
                </div>
              </div>
            </div>
          </div>

          <!-- Actions -->
          <div class="results-actions">
            <button type="button" class="btn btn-secondary" onclick="resetForm()">
              <i class="fas fa-redo"></i>
              Nova Classificação
            </button>
            <button type="button" class="btn btn-primary" onclick="downloadResults()">
              <i class="fas fa-download"></i>
              Baixar Resultados
            </button>
          </div>
        </div>
      </section>

      <!-- Gmail Section -->
      <section class="upload-section" id="gmailSection">
        <div class="upload-card">
          <div class="upload-header">
            <h2><i class="fas fa-envelope"></i> Gmail</h2>
            <p>Autentique-se com o Google e visualize emails não lidos, classificação e resposta sugerida</p>
          </div>

          <div class="submit-section" style="gap: 8px; display: flex; flex-wrap: wrap;">
            <button type="button" class="btn btn-secondary" id="gmailAuthBtn">
              <i class="fas fa-sign-in-alt"></i>
              Conectar ao Gmail
            </button>
            <button type="button" class="btn btn-primary" id="gmailRefreshBtn">
              <i class="fas fa-sync"></i>
              Atualizar Lista
            </button>
          </div>

          <div id="gmailList" style="margin-top: 16px;"></div>
        </div>
      </section>

      <!-- Loading Overlay -->
      <div class="loading-overlay" id="loadingOverlay" style="display: none;">
        <div class="loading-content">
          <div class="spinner"></div>
          <h3 class="loading-text">Processando Email...</h3>
          <p>Nossa IA está analisando o conteúdo e gerando uma resposta personalizada</p>
        </div>
      </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
      <div class="footer-content">
        <p>&copy; 2024 Sistema de Classificação de Emails. Powered by <strong>Gemini AI</strong></p>
        <div class="footer-links">
          <a href="#" onclick="testAI()">
            <i class="fas fa-vial"></i>
            Testar IA
          </a>
          <a href="/health" target="_blank">
            <i class="fas fa-heartbeat"></i>
            Status da API
          </a>
        </div>
      </div>
    </footer>
  </div>

  <!-- Toast Notifications -->
  <div class="toast-container" id="toastContainer"></div>

  <!-- Scripts modulares -->
  <!-- Firebase SDK -->
  <script src="js/firebase-config.js"></script>

  <!-- Auth Services -->
  <script src="js/auth-service.js"></script>
  <script src="js/auth-components.js"></script>

  <!-- Existing Scripts -->
  <script src="js/config.js"></script>
  <script src="js/dom.js"></script>
  <script src="js/validation.js"></script>
  <script src="js/file-handler.js"></script>
  <script src="js/api.js"></script>
  <script src="js/ui.js"></script>
  <script src="js/app.js"></script>

  <!-- Script de inicialização -->
  <script>
    // Garantir que a interface de login apareça
    document.addEventListener('DOMContentLoaded', function () {
      console.log('🚀 DOM carregado, inicializando interface...');

      // Mostrar seção de login por padrão
      const loginSection = document.getElementById('loginSection');
      if (loginSection) {
        loginSection.style.display = 'block';
        console.log('✅ Seção de login exibida');
      }

      // Aguardar um pouco e verificar se os serviços carregaram
      setTimeout(() => {
        if (window.authComponents && window.authComponents.authService) {
          console.log('✅ Serviços de autenticação carregados');
          // Os componentes vão gerenciar a UI automaticamente
        } else {
          console.log('⚠️ Serviços de autenticação ainda não carregados');
        }
      }, 1000);
    });
  </script>
</body>

</html>